# Backlog

## 2025-10-09 - Рефакторинг стратегии в соответствии с `signals.txt`

### Тип: Рефакторинг

### Описание
Полностью переработана `PortedFromExampleStrategy` для приведения в соответствие с официальной документацией `signals.txt`.

### Ключевые изменения:
- **`signal_generators.py`**:
    - Логика генерации сигналов теперь строго соответствует "Этапу 1".
    - Исправлен расчет процентилей (`vol_pctl`, `rng_pctl`).
    - Удалена посторонняя логика фильтрации (`enable_additional_filters`), которая относилась к этапу подтверждения.
- **`ported_from_example_strategy.py`**:
    - Устранен дублирующийся код (удалена старая версия `_build_trades_numba`).
    - Торговый цикл `_build_trades_numba` полностью переписан для соответствия "Этапам 2 и 3".
    - Реализован параметр `entry_logic_mode` для гибкого выбора логики определения направления.
    - Реализованы параметры `hldir_offset` и `aggressive_mode`.
    - Логика входа, выхода, SL/TP приведена к стандартному виду, описанному в `signals.txt`.
    - Обновлены параметры по умолчанию и пространство поиска гиперпараметров.

### Обоснование
Предыдущая реализация содержала дублирование, ошибки в расчетах и значительные отклонения от документированной логики. Рефакторинг устранил эти проблемы, сделав код чистым, предсказуемым и полностью управляемым через параметры, что критически важно для дальнейшей оптимизации и тестирования.

---

## 2025-10-10 - Оптимизация производительности бэктестера

### Тип: Оптимизация

### Описание
В ходе анализа было выявлено, что бэктестер значительно замедлялся при определенных комбинациях параметров, которые генерировали большое количество сделок. Время выполнения одного прогона оптимизации могло достигать 28 секунд.

Проблема была локализована в функции `_vectorized_find_exit` в `ported_from_example_strategy.py`. Эта функция для каждой сделки создавала полные срезы данных от точки входа до конца истории, что приводило к экспоненциальному росту потребления памяти и процессорного времени при увеличении числа сделок.

### Ключевые изменения:
- **`ported_from_example_strategy.py`**:
    - Неэффективная "векторизованная" функция `_vectorized_find_exit` была заменена на новую, итеративную Numba-функцию `_find_exit_optimized`.
    - Новая функция итерируется по свечам после входа и немедленно прекращает работу при нахождении первого условия для выхода (SL, TP или агрессивный выход), что исключает создание больших массивов в памяти.

### Обоснование
Замена алгоритма поиска выхода на итеративный, но скомпилированный с помощью Numba, позволила на порядки ускорить обработку сделок. Это устранило "бутылочное горлышко" в производительности и сделало процесс оптимизации значительно более быстрым и стабильным, независимо от количества генерируемых сделок.