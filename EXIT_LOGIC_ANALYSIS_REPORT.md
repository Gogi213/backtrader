# üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–û–ì–ò–ö–ò –¢–ï–ô–ö-–ü–†–û–§–ò–¢–ê –ò –°–¢–û–ü-–õ–û–°–°–ê

## üéØ –¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê –í –ö–û–î–ï

### 1. **–£–°–õ–û–í–ò–Ø –í–•–û–î–ê:**

**–õ–û–ù–ì –≤—Ö–æ–¥:**
```python
prices[i+1] <= lower_band[i+1] AND prices[i] > lower_band[i]
```
- –¶–µ–Ω–∞ –ø–µ—Ä–µ—Å–µ–∫–ª–∞ –Ω–∏–∂–Ω—é—é –ø–æ–ª–æ—Å—É Bollinger Bands —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è Mean Reversion: –ø–æ–∫—É–ø–∞–µ–º –Ω–∞ "–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏"

**–®–û–†–¢ –≤—Ö–æ–¥:**
```python
prices[i+1] >= upper_band[i+1] AND prices[i] < upper_band[i]
```
- –¶–µ–Ω–∞ –ø–µ—Ä–µ—Å–µ–∫–ª–∞ –≤–µ—Ä—Ö–Ω—é—é –ø–æ–ª–æ—Å—É Bollinger Bands —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è Mean Reversion: –ø—Ä–æ–¥–∞–µ–º –Ω–∞ "–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏"

### 2. **–£–°–õ–û–í–ò–Ø –í–´–•–û–î–ê:**

#### **–õ–û–ù–ì –≤—ã—Ö–æ–¥—ã:**
```python
# –°–¢–û–ü-–õ–û–°–°:
if prices[i] <= prices[i-1] * (1 - stop_loss_pct):
    exit_signal = 1

# –¢–ï–ô–ö-–ü–†–û–§–ò–¢ (–≤–æ–∑–≤—Ä–∞—Ç –∫ —Å—Ä–µ–¥–Ω–µ–π):
if prices[i] >= sma[i]:
    exit_signal = 1
```

#### **–®–û–†–¢ –≤—ã—Ö–æ–¥—ã:**
```python
# –°–¢–û–ü-–õ–û–°–°:
if prices[i] >= prices[i-1] * (1 + stop_loss_pct):
    exit_signal = -1

# –¢–ï–ô–ö-–ü–†–û–§–ò–¢ (–≤–æ–∑–≤—Ä–∞—Ç –∫ —Å—Ä–µ–¥–Ω–µ–π):
if prices[i] <= sma[i]:
    exit_signal = -1
```

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. **–ù–ï–í–û–ó–ú–û–ñ–ù–û –†–ê–ó–õ–ò–ß–ò–¢–¨ –°–¢–û–ü –û–¢ –¢–ï–ô–ö–ê:**
```python
'exit_reason': 'stop_loss' if abs(exit_signal) == 1 else 'target_hit'
```
- `abs(exit_signal)` –í–°–ï–ì–î–ê —Ä–∞–≤–µ–Ω 1 (–∏ –¥–ª—è —Å—Ç–æ–ø–∞, –∏ –¥–ª—è —Ç–µ–π–∫–∞)
- `exit_reason` –í–°–ï–ì–î–ê –±—É–¥–µ—Ç `'stop_loss'` (–Ω–∏–∫–æ–≥–¥–∞ `'target_hit'`)

### 2. **–°–¢–û–ü-–õ–û–°–° –í–´–ß–ò–°–õ–Ø–ï–¢–°–Ø –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:**
```python
# –¢–ï–ö–£–©–ï–ï (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
stop_loss = prices[i-1] * (1 - stop_loss_pct)  # –û—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ü–µ–Ω—ã

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
stop_loss = entry_price * (1 - stop_loss_pct)  # –û—Ç —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
```

### 3. **–ù–ï–¢ –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ì–û –¢–ï–ô–ö-–ü–†–û–§–ò–¢–ê:**
- –¢–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—Ç –∫ SMA (—Å—Ä–µ–¥–Ω—è—è –ª–∏–Ω–∏—è BB)
- –ù–µ—Ç –æ–ø—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ % —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞

## üìã –û–¢–í–ï–¢–´ –ù–ê –í–û–ü–†–û–°–´

### **–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –¢–ï–ô–ö-–ü–†–û–§–ò–¢–û–ú:**
1. **–í–æ–∑–≤—Ä–∞—Ç –∫ —Å—Ä–µ–¥–Ω–µ–π (SMA):** `price >= sma[i]` –¥–ª—è –ª–æ–Ω–≥–∞, `price <= sma[i]` –¥–ª—è —à–æ—Ä—Ç–∞
2. **–ù–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, +1%)

### **–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –°–¢–û–ü-–õ–û–°–°–û–ú:**
1. **–î–ª—è –ª–æ–Ω–≥–∞:** `price <= prev_price * (1 - 0.5%)`
2. **–î–ª—è —à–æ—Ä—Ç–∞:** `price >= prev_price * (1 + 0.5%)`
3. **–ü–∞—Ä–∞–º–µ—Ç—Ä:** `stop_loss_pct = 0.005` (0.5%)

### **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è:**
- –í –∫–æ–¥–µ `exit_reason` –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `'stop_loss'`
- –ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ –Ω–µ–ª—å–∑—è –æ—Ç–ª–∏—á–∏—Ç—å —Å—Ç–æ–ø –æ—Ç —Ç–µ–π–∫–∞

## üöÄ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### 1. **–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –õ–û–ì–ò–ö–ò EXIT_SIGNALS:**
```python
# –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê:
exit_signal = 1   # –°—Ç–æ–ø-–ª–æ—Å—Å –ª–æ–Ω–≥
exit_signal = 2   # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –ª–æ–Ω–≥ (SMA)
exit_signal = 3   # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –ª–æ–Ω–≥ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π %)
exit_signal = -1  # –°—Ç–æ–ø-–ª–æ—Å—Å —à–æ—Ä—Ç
exit_signal = -2  # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç —à–æ—Ä—Ç (SMA)
exit_signal = -3  # –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç —à–æ—Ä—Ç (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π %)
```

### 2. **–ù–û–í–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:**
```python
class VectorizedBollingerStrategy:
    def __init__(self,
                 stop_loss_pct: float = 0.5,      # –°—Ç–æ–ø-–ª–æ—Å—Å %
                 take_profit_pct: float = None,   # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π TP %
                 use_bb_reversal: bool = True,    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SMA –∫–∞–∫ TP
                 commission_pct: float = 0.05):   # –ö–æ–º–∏—Å—Å–∏—è %
```

### 3. **–í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ê –ì–†–ê–§–ò–ö–ï:**
```python
# –í–•–û–î–´:
- –õ–æ–Ω–≥ –≤—Ö–æ–¥: –ó–µ–ª–µ–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ –í–í–ï–†–• ‚ñ≤
- –®–æ—Ä—Ç –≤—Ö–æ–¥: –ö—Ä–∞—Å–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ –í–ù–ò–ó ‚ñº

# –í–´–•–û–î–´:
- –°—Ç–æ–ø-–ª–æ—Å—Å: –ö—Ä–∞—Å–Ω—ã–π X ‚úó
- –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (SMA): –ó–µ–ª–µ–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç ‚ñ†
- –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (—Ñ–∏–∫—Å): –ñ–µ–ª—Ç—ã–π –∫—Ä—É–≥ ‚óè
- –õ–∏–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω—è—é—â–∏–µ –≤—Ö–æ–¥-–≤—ã—Ö–æ–¥
```

### 4. **–ò–ù–§–û–†–ú–ê–¢–ò–í–ù–´–ï –ü–û–î–ü–ò–°–ò:**
- "SL -0.5%" –¥–ª—è —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
- "TP SMA" –¥–ª—è —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞ –ø–æ SMA
- "TP +1.2%" –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞
- –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏

## üìà –¢–ï–ö–£–©–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´

- **BB –ø–µ—Ä–∏–æ–¥:** 50
- **BB —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:** 2.0
- **–°—Ç–æ–ø-–ª–æ—Å—Å:** 0.5%
- **–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç:** –¢–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—Ç –∫ SMA
- **–ö–æ–º–∏—Å—Å–∏—è:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **–ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

## üéØ –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´

**–¢–ï–ô–ö-–ü–†–û–§–ò–¢:** –í–æ–∑–≤—Ä–∞—Ç —Ü–µ–Ω—ã –∫ —Å—Ä–µ–¥–Ω–µ–π –ª–∏–Ω–∏–∏ Bollinger Bands (SMA)
**–°–¢–û–ü-–õ–û–°–°:** –î–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ 0.5% –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ü–µ–Ω—ã
**–ü–†–û–ë–õ–ï–ú–ê:** –ù–µ–ª—å–∑—è —Ä–∞–∑–ª–∏—á–∏—Ç—å –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –∏–∑-–∑–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö exit_signal –∑–Ω–∞—á–µ–Ω–∏–π
**–†–ï–®–ï–ù–ò–ï:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –ø–ª–∞–Ω —Å —Ä–∞–∑–Ω—ã–º–∏ exit_signal –∫–æ–¥–∞–º–∏